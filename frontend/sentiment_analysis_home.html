<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentiment Analysis</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap');
        </style>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #000000;
        }
        .container {
            width: 80%;
            margin: auto;
            overflow: hidden;
        }
        #aboutProjectBtn {
            position: absolute;  /* Use absolute positioning */
            top: 957px;            /* Center vertically */
            right: 20px;         /* Space from the right edge */
            transform: translateY(-50%);  /* Adjust vertical centering */
            padding: 10px 20px; /* Add some padding for size */
            background-color: #007bff; /* Blue background color */
            color: #fff;        /* White text color */
            border: none;       /* Remove default border */
            border-radius: 5px; /* Rounded corners */
            font-size: 16px;    /* Font size */
            cursor: pointer;    /* Pointer cursor on hover */
            transition: background-color 0.3s ease; /* Smooth background color transition */
        }

        #aboutProjectBtn:hover {
            background-color: #0056b3; /* Darker blue on hover */
        }
        header {
            background: rgb(0, 0, 0);
            color: #fff;
            padding-top: 30px;
            min-height: 70px;
            border-bottom: #bbb 1px solid;
            margin-bottom: 20px;
        }
        header h1 {
            text-align: center;
            font-size: 12px;
            font-family: "Cormorant Garamond", serif;
            font-weight: 300;
            font-style: normal;
            margin: 0;
        }
        .title {
        font-size: 2.5em; /* Larger size for the title */
        font-weight: bolder; /* Make the title bold */
        /*color: #333; Adjust color as needed */
        }
        .subtitle {
        font-size: 20px; /* Smaller size for the subtitle */
        font-family: 'Times New Roman', Times, serif;
        font-weight: 100;
        position: relative;
        bottom: 87px;
        right: 114px;
        }
        .info-container {
        margin-top: 20px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: hsl(0, 0%, 18%);
        }
        .info-container h2 {
        font-size: 1.8em;
        margin-bottom: 10px;
        }
        .info-container p {
        font-size: 1em;
        line-height: 1.6;
        margin-bottom: 10px;
        }
        .info-container ul {
        margin: 10px 0;
        padding-left: 20px;
        }
        .info-container ul li {
        margin-bottom: 5px;
        }
        .form-container {
            background: #fff;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .form-container label {
            display: block;
            margin: 10px 0 5px;
        }
        .form-container select, .form-container input[type="text"] {
            margin: 10px 0;
            padding: 10px;
            width: 100%;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .form-container select.highlighted {
            border-color: #007BFF;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
        }
        .form-container button {
            background: #333;
            color: #fff;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
        }
        .form-container button:hover {
            background: #555;
        }
        .result-container, .details-container, .navigation-container, .csv-download-container {
            background: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }
        .progress-container {
            margin: 20px 0;
        }
        .progress-bar {
            background: #ddd;
            border-radius: 5px;
            overflow: hidden;
            height: 20px;
            width: 100%;
            position: relative;
        }
        .progress-bar .progress-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-weight: bold;
        }
        .progress-bar.overall {
            background: #4caf50;
        }
        .progress-bar.feature {
            background: #2196f3;
        }
        .hidden {
            display: none;
        }
        .form-container input[type="checkbox"] {
            margin-right: 10px;
        }
        .form-container label input[type="checkbox"] {
            margin-right: 5px;
        }
        /* CSS for the button */
        .last-result-button {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: #fff;
            cursor: pointer;
            margin: 10px;
            transition: background-color 0.3s ease;
            text-align: center;
        }

        .last-result-button:hover {
            background-color: #0056b3;
        }

        /* CSS for the container div */
        .csv-last-result-container {
            padding: 20px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            text-align: center;
        }
        .close-button {
    font-size: 18px;
    font-weight: bold;
    color: red;
    cursor: pointer;
    margin-left: 690px; /* Space between the newButton and the X */
    background: none;
    border: none;
    user-select: none; /* Prevents text selection */

    
}
.close-button:hover {
    color: red; /* Optional: change color on hover to indicate interactivity */
}

    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>
                <span class="title" style="font-size: 122px; font-weight: 100; position: relative; right: 311px;">S</span>
            </h1>
            <h1 style="position: relative;
            letter-spacing: 28px;
            text-align: left;
            line-height: 38px;
            position: relative;
            left: 526px;
            bottom: 115px;
            font-weight: bolder;">
                <span class="title" style="font-size: 40px; position: relative; right: 131px;">ENTIMENT</span><br>
                <span class="title" style="font-size: 40px; position: relative; right: 131px;">PECTRUM</span>
            </h1>
            <img
            src="{{ url_for('serve_frontend_files', filename='Spectrum.png') }}"
            style="width: 455px; height: 5px; position: relative; bottom: 120px; left: 340px;"
            alt="Spectrum Image"
            />

            <span class="subtitle">Live Review Sentiment Monitoring & Analysis System</span>
            <button id="aboutProjectBtn" type="button">About This Project</button>
            <script>
                document.getElementById('aboutProjectBtn').addEventListener('click', function() {
                    window.location.href = 'about_project.html';
                });
            </script>
        </div>

        <div class="info-container">
            <h2>About This Project</h2>
            <p>
                Welcome to the Sentiment Spectrum Review & Analysis System!
                       </p>
            <p>
                This cutting-edge tool leverages advanced techniques in machine learning and artificial intelligence to provide deep insights into customer reviews across various websites.
            </p>
            <p>
                Key Features
            </p>
            <ul>
                <li>Advanced Sentiment Analysis : Utilizes the state-of-the-art NLP model <strong>nlptown/bert-base-multilingual-uncased-sentiment</strong> for accurate sentiment classification. This model is designed to handle multiple languages and extract nuanced sentiments from review texts.</li>
                <li>Machine Learning Integration : Employs sophisticated algorithms to analyze patterns in reviews, allowing for personalized insights based on user input.</li>
                <li>Data Science Driven Insights : Provides comprehensive reports and visualizations derived from large datasets, enabling users to make data-informed decisions and understand trends.</li>
                <li>Customizable Review Scraping : Choose specific brands and models to tailor the scraping process and gather relevant data efficiently.</li>
                <li>Review Type Specification : Select between overall or feature-specific reviews to focus on different aspects of the data.</li>
                <li>Progress Tracking : Monitor the status of your scraping and analysis tasks in real-time, ensuring you stay updated on the progress.</li>
                <li>CSV File Downloads : Access and download detailed CSV files containing the scraped data for further analysis and reporting.</li>
            </ul>
            <p>
                **Why Sentiment Spectrum?** This project harnesses the power of AI and machine learning to streamline the process of sentiment analysis, making it easier for users to extract valuable insights from customer feedback. Whether you're looking to understand customer sentiment, track brand performance, or gain competitive intelligence, this system offers the tools you need to succeed.
            </p>
            <p>
                The Sentiment Spectrum system showcases expertise in machine learning, natural language processing (NLP), and data analysis. It represents a practical application of advanced AI techniques, making it a valuable asset for professionals interested in cutting-edge data science projects and AI-driven solutions.
            </p>
            <p>
                Use the navigation buttons to explore detailed analysis, geographical visualizations, or download CSV files for in-depth examination. Our goal is to empower you with actionable insights and enhance your understanding of sentiment trends in customer reviews.
            </p>
        </div>

    </header>

    <div class="container">
        <div class="form-container">
            <h2>Get the live Reviews</h2>
            <h3>Enter Details</h3>
            <p>
                Select a brand and model, and our system will automatically generate a link for the product.
            </p>
            <p>
                Alternatively, you can provide a direct link to the product. Please ensure that the link is for a smartphone with at least 4,000 reviews to ensure comprehensive analysis.
            </p>
            <p>
                New here? Try out our <button id="demoBtn">Demo</button> to see how it works!
            </p>
            <form id="detailsForm" action="/validate_link" method="post">
                <label for="brand">Brand:</label>
                <select name="brand" id="brand">
                    <option value="">Select Brand</option>
                    <option value="iPhone">iPhone</option>
                    <option value="Samsung">Samsung</option>
                    <option value="Xiomi">Xiomi</option>
                    <option value="Oneplus">Oneplus</option>

                </select>

                <label for="model">Model:</label>
                <select name="model" id="model" disabled>
                    <option value="">Select Model</option>
                </select>

                <label for="website">Website Link:</label>
                <input type="text" name="website" id="website" placeholder="Enter website link">
                <label><input type="checkbox" name="overallReview" id="overallReview"> Overall Review</label>
                <label><input type="checkbox" name="featureReview" id="featureReview"> Feature Review</label>
                <div id="featureOptions" class="hidden">
                    <label><input type="checkbox" name="subFeature" value="camera"> Camera</label>
                    <label><input type="checkbox" name="subFeature" value="battery"> Battery</label>
                    <label><input type="checkbox" name="subFeature" value="display"> Display</label>
                    <label><input type="checkbox" name="subFeature" value="performance"> Performance</label>
                </div>

                <button type="submit">Start Review Scraping</button>
            </form>
        </div>

        <div class="progress-container hidden" id="overallProgressSection">
            <h2>Overall Review Progress</h2>
            <div class="progress-bar overall" id="overallProgressBarContainer">
                <div class="progress-label" id="overallProgressBar">0%</div>
            </div>
        </div>

        <div class="progress-container hidden" id="featureProgressSection">
            <h2>Feature Review Progress</h2>
            <div class="progress-bar feature" id="featureProgressBarContainer">
                <div class="progress-label" id="featureProgressBar">0%</div>
            </div>
        </div>

        <div class="navigation-container" id="analysisVisualisationContainer">
            <button type="button" id="analysisBtn">Analysis and Visualisation</button>
            <div>
                <div id="analysisLastResultContainer"></div>
            </div>
            <div id="analysisDynamicFormContainer"></div>
        </div>

        <div class="navigation-container" id="geographicalVisualisationContainer">
            <button type="button" id="geoVisBtn">Go to Geographical Visualisation</button>
            <div><div id="geoVisualisationLastResultContainer"></div></div>
            <div id="geoVisDynamicFormContainer"></div>
        </div>

        <div class="csv-download-container" id="csvDownloadContainer">
            <button type="button" id="csvDownloadBtn">View and Download CSV Files</button>
            <div id="csvLastResultContainer"></div>
            <div id="csvDynamicFormContainer"></div>
        </div>

    </div>

    <script>
let lastResult = false;
document.addEventListener('DOMContentLoaded', () => {
    const brandSelect = document.getElementById('brand');
    const modelSelect = document.getElementById('model');
    const websiteInput = document.getElementById('website');
    const featureReviewCheckbox = document.getElementById('featureReview');
    const overallReviewCheckbox = document.getElementById('overallReview');
    const featureOptions = document.getElementById('featureOptions');
    const detailsContainer = document.getElementById('details');
    const csvDownloadContainer = document.getElementById('csvDownloadContainer');

    function demoOverlay() {
        // Clear any existing overlays
        const container = document.querySelector('.form-container');
        container.innerHTML = '';

        // Create new div for the demo overlay
        const demoOverlay = document.createElement('div');
        demoOverlay.className = 'demo-overlay';
        demoOverlay.innerHTML = `
            <div class="demo-content">
                <h2>Demo Mode</h2>
                <p>
                    This is a demo mode. You can now see how the system works with predefined data.
                </p>
                <button id="continueBtn">Continue</button>
                <button id="cancelBtn">Cancel</button>
            </div>
            `;

        // Append the demo overlay to the container
        container.appendChild(demoOverlay);

        // Add event listeners to the buttons
        document.getElementById('continueBtn').addEventListener('click', function() {
            // Proceed with the demo actions
            const requestData = {
            brand: 'iPhone',
            model: 'iPhone 15'
            };

            // Make the fetch request with the predefined data
            fetch('/validate_link', {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Scraping completed successfully!');
                    lastResult = true;
                    createExtraOptions(true);
                } else {
                    alert(`Error: ${data.message}`);
                    createExtraOptions(false);
                }
            })
            .catch(error => {
                console.error('Error starting the scraping process:', error);
                alert('An error occurred while starting the scraping process. Please try again.');
            });
            // You can add code here to proceed with demo actions
            });

        document.getElementById('cancelBtn').addEventListener('click', function() {
            // Revert to the initial form
            window.location.reload();
        });
    }



    document.getElementById('demoBtn').addEventListener('click', function() {
        // Define the request data for the demo
        demoOverlay();
    });

    // Handle brand change
    brandSelect.addEventListener('change', function() {
        const brand = this.value;
        modelSelect.innerHTML = '<option value="">Select Model</option>'; // Clear previous options
        modelSelect.disabled = !brand;

        if (brand) {
            fetch(`/get_models?brand=${brand}`)
                .then(response => response.json())
                .then(models => {
                    if (models.length === 0) {
                        modelSelect.innerHTML += '<option value="">No models available</option>';
                    } else {
                        models.forEach(model => {
                            const option = document.createElement('option');
                            option.value = model;
                            option.textContent = model;
                            modelSelect.appendChild(option);
                        });
                        modelSelect.classList.add('highlighted');
                    }
                })
                .catch(error => console.error('Error fetching models:', error));
        } else {
            modelSelect.classList.remove('highlighted');
        }

        // Disable website input if brand is selected
        websiteInput.disabled = brand !== '';
    });

    // Handle website input
    websiteInput.addEventListener('input', function() {
        const websiteEntered = this.value !== '';
        brandSelect.disabled = websiteEntered;
        modelSelect.disabled = websiteEntered;

        if (websiteEntered) {
            modelSelect.classList.remove('highlighted');
        }
    });

    // Function to lock/unlock all checkboxes
    const handleCheckboxLock = () => {
        const isOverallChecked = overallReviewCheckbox.checked;
        const isFeatureChecked = featureReviewCheckbox.checked;

        // If either checkbox is checked, lock all checkboxes
        const lockAll = isOverallChecked || isFeatureChecked;

        if (lockAll) {
            featureOptions.style.display = 'block';
            featureOptions.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = true;       // Ensure the checkbox is checked
                checkbox.disabled = true;      // Disable the checkbox to lock it
            });
        } else {
            featureOptions.style.display = 'none';
            featureOptions.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;      // Uncheck the checkbox
                checkbox.disabled = false;     // Re-enable the checkbox
            });
        }
    };

    // Handle overall review checkbox change
    overallReviewCheckbox.addEventListener('change', handleCheckboxLock);

    // Handle feature review checkbox change
    featureReviewCheckbox.addEventListener('change', handleCheckboxLock);

    document.getElementById('detailsForm').addEventListener('submit', function(event) {
        event.preventDefault();

        const formData = new FormData(this);
        const brand = formData.get('brand');
        const model = formData.get('model');
        const website = formData.get('website');
        const overallReview = formData.get('overallReview') ? 'Yes' : 'No';
        const featureReview = formData.get('featureReview') ? 'Yes' : 'No';

        // Determine subFeatures based on overall or feature review
        let subFeatures = [];
        if (overallReview === 'Yes') {
            subFeatures = Array.from(document.querySelectorAll('#featureOptions input[type="checkbox"]'))
                .map(checkbox => checkbox.value);
        } else {
            subFeatures = Array.from(formData.getAll('subFeature'));
        }

        // Validate the form inputs
        if (brand && !model) {
            alert('Please choose a model.');
            return;
        }
        if (!brand && !website) {
            alert('Please select a brand or enter a website link.');
            return;
        }

        // Display the selected details (for debugging or confirmation)
        let detailsHTML = '<ul>';
        detailsHTML += `<li><strong>Brand:</strong> ${brand || 'N/A'}</li>`;
        detailsHTML += `<li><strong>Model:</strong> ${model || 'N/A'}</li>`;
        detailsHTML += `<li><strong>Website Link:</strong> ${website || 'N/A'}</li>`;
        detailsHTML += `<li><strong>Overall Review:</strong> ${overallReview}</li>`;
        detailsHTML += `<li><strong>Feature Review:</strong> ${featureReview}</li>`;
        detailsHTML += `<li><strong>Sub Features:</strong> ${subFeatures.join(', ') || 'N/A'}</li>`;
        detailsHTML += '</ul>';

        // Function to create and display the demo overlay
        function scrapingOverlay() {
            const container = document.querySelector('.form-container');
            container.innerHTML = '';

            const scrapingOverlay = document.createElement('div');
            scrapingOverlay.className = 'demo-overlay';
            scrapingOverlay.innerHTML = `
                <div class="demo-content">
                    <h2>The Analysis Process</h2>
                        <p>We're about to start the analysis, and it might take around 10-15 minutes. Here's what we'll be doing:</p>
                        <ul>
                            <li><strong>Data Collection:</strong> We'll scrape live data from the target website.</li>
                            <li><strong>Cleaning and Preprocessing:</strong> We'll clean up the data and get it ready for analysis.</li>
                            <li><strong>Sentiment Analysis:</strong> We'll analyze the sentiments behind the customer reviews, labeling them as positive, negative, or neutral.</li>
                            <li><strong>Data Visualization:</strong> We'll create various graphs and plots from both the raw data and the sentiment analysis.</li>
                            <li><strong>Geographical Data Collection:</strong> We'll convert the reviewers' locations to latitude and longitude using an API service.</li>
                        </ul>
                        <p>If you'd like to continue with this full process, just press "Continue."</p>
                        <p>Alternatively, you can skip the live analysis and start right away by selecting a visualization method at the bottom of this page. From there, you can choose data from our database to analyze. 
                            <input type="button" class="skip" value="Skip" onclick="window.location.href='skipToAnalysis'">
                        </p>
                    <button id="continueBtn">Continue</button>
                    <button id="cancelBtn">Cancel</button>
                </div>
            `;
            
            container.appendChild(scrapingOverlay);

            document.getElementById('continueBtn').addEventListener('click', function() {
                fetch('/validate_link', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ brand, model, website, overallReview, featureReview, subFeatures })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Scraping completed successfully!');
                        lastResult = true;
                        createExtraOptions(true);
                    } else {
                        alert(`Error: ${data.message}`);
                        createExtraOptions(false);
                    }
                })
                .catch(error => {
                    console.error('Error starting the scraping process:', error);
                    alert('Error starting the scraping process. Please try again.');
                });
            });

            document.getElementById('cancelBtn').addEventListener('click', function() {
                // Reload the page to revert to the initial form
                window.location.reload();
            });
        }

        // Call the function to display the demo overlay
        scrapingOverlay();
    });


    
    document.getElementById('analysisBtn').addEventListener('click', function(event) {
    // Check if lastResult is true
    if (lastResult === true) {
        // Create a new button element for 'Scraped Result Analysis and Visualisation'
        const newButton = document.createElement('button');
        newButton.textContent = 'Scraped Result Analysis and Visualisation';
        newButton.className = 'last-result-button';

        // Set up the button click event to navigate to '/analysis'
        newButton.addEventListener('click', function() {
            window.location.href = '/analysis';
        });

        // Create an 'X' button for closing
        const closeButton = document.createElement('span');
        closeButton.textContent = '✖'; // 'X' mark character
        closeButton.className = 'close-button'; // Class for styling the 'X'

        // Add functionality to 'X' to hide the containers
        closeButton.addEventListener('click', function() {
            const analysisLastResultContainer = document.getElementById('analysisLastResultContainer');
            const analysisDynamicFormContainer = document.getElementById('analysisDynamicFormContainer');

            // Clear the content of both containers to hide them
            analysisLastResultContainer.innerHTML = '';
            analysisDynamicFormContainer.innerHTML = '';
        });

        // Select the container where the new buttons will be appended
        const analysisLastResultContainer = document.getElementById('analysisLastResultContainer');
        
        // Clear the container's content and add a new div with buttons
        analysisLastResultContainer.innerHTML = `
            <div id="analysisLastResultButton" class="last-result-button-container"></div>
        `;
        
        // Select the new div and append both the newButton and closeButton ('X' mark) to it
        const analysisLastResultButton = document.getElementById('analysisLastResultButton');
        analysisLastResultButton.appendChild(newButton);
        analysisLastResultButton.appendChild(closeButton);
    }

    // Call the createBrandModelForm function (this will generate the form in analysisDynamicFormContainer)
    createBrandModelForm('analysisDynamicFormContainer', '/analysis');
});


document.getElementById('geoVisBtn').addEventListener('click', function(event) {
    if (lastResult === true) {
        // Create a new button element
        const newButton = document.createElement('button');
        newButton.textContent = 'Scraped Result Geographical Visualisation';
        
        // Set up the button click event
        newButton.addEventListener('click', function() {
            window.location.href = '/geographical_visualisation';
        });

        // Style the button
        newButton.className = 'last-result-button';

        // Create an 'X' button for closing
        const closeButton = document.createElement('span');
        closeButton.textContent = '✖'; // 'X' mark character
        closeButton.className = 'close-button'; // Class for styling the 'X'

        // Add functionality to 'X' to hide the containers
        closeButton.addEventListener('click', function() {
            const geoVisualisationLastResultContainer = document.getElementById('geoVisualisationLastResultContainer');
            const geoVisDynamicFormContainer = document.getElementById('geoVisDynamicFormContainer');

            // Clear the content of both containers to hide them
            geoVisualisationLastResultContainer.innerHTML = '';
            geoVisDynamicFormContainer.innerHTML = '';
        });

        // Select the container where the button will be appended
        const geoVisualisationLastResultContainer = document.getElementById('geoVisualisationLastResultContainer');

        // Clear any existing content in the container and add a new div with buttons
        geoVisualisationLastResultContainer.innerHTML = `
            <div id="geoVisualisationLastResultButton" class="last-result-button-container"></div>
        `;

        // Select the new div and append both the newButton and closeButton ('X' mark) to it
        const geoVisualisationLastResultButton = document.getElementById('geoVisualisationLastResultButton');
        geoVisualisationLastResultButton.appendChild(newButton);
        geoVisualisationLastResultButton.appendChild(closeButton);
    }

    // Call the createBrandModelForm function (this will generate the form in geoVisDynamicFormContainer)
    createBrandModelForm('geoVisDynamicFormContainer', '/geographical_visualisation');
});

    document.getElementById('csvDownloadBtn').addEventListener('click', function(event) {
        if (lastResult === true) {
            // Create a new button element
            const newButton = document.createElement('button');
            newButton.textContent = 'Sentiment Result CSV files';

            // Set up the button click event
            newButton.addEventListener('click', function() {
                window.location.href = '/load_csv';
            });
            // Apply CSS class to the button
            newButton.className = 'last-result-button';

            // Create an 'X' button for closing
        const closeButton = document.createElement('span');
        closeButton.textContent = '✖'; // 'X' mark character
        closeButton.className = 'close-button'; // Class for styling the 'X'

        // Add functionality to 'X' to hide the containers
        closeButton.addEventListener('click', function() {
            const csvLastResultContainer = document.getElementById('csvLastResultContainer');
            const csvDynamicFormContainer = document.getElementById('csvDynamicFormContainer');

            // Clear the content of both containers to hide them
            csvLastResultContainer.innerHTML = '';
            csvDynamicFormContainer.innerHTML = '';
        });
            // Select the container where the button will be appended
            const csvLastResultContainer = document.getElementById('csvLastResultContainer');
            // Clear any existing content in the container and add a new div
            csvLastResultContainer.innerHTML = `
                <div id="csvLastResultButton" class="last-result-button-container"></div>
            `;
                   // Select the new div and append both the newButton and closeButton ('X' mark) to it
        const csvLastResultButton = document.getElementById('csvLastResultButton');
        csvLastResultButton.appendChild(newButton);
        csvLastResultButton.appendChild(closeButton);
    }

    // Call the createBrandModelForm function (this will generate the form in csvDynamicFormContainer)
    createBrandModelForm('csvDynamicFormContainer', '/load_csv');
});

    function createBrandModelForm(containerId, newHtmlLink) {
        // Get the target container where the form will be injected
        const dynamicFormContainer = document.getElementById(containerId);

        // Set the inner HTML of the container to the form structure
        dynamicFormContainer.innerHTML = `
            <div class="form-container">
                <p>Get the result from the historical data</p>
                <h3>Choose from Database</h4>
                <h4>Select Brand and Model</h4>
                <form id="dynamicForm">
                    <label for="brandSelect">Brand:</label>
                    <select name="brand" id="brandSelect">
                        <option value="">Select Brand</option>
                        <option value="iPhone">iPhone</option>
                        <option value="Samsung">Samsung</option>
                        <option value="Xiomi">Xiomi</option>
                        <option value="Oneplus">Oneplus</option>
                    </select>

                    <label for="modelSelect">Model:</label>
                    <select name="model" id="modelSelect" disabled>
                        <option value="">Select Model</option>
                    </select>
                    <button type="button" id="goButton">Go</button>
                </form>
            </div>
        `;

        // Add event listener to dynamically created brand select
        const brandSelect = dynamicFormContainer.querySelector('#brandSelect');
        const modelSelect = dynamicFormContainer.querySelector('#modelSelect');
        const goButton = dynamicFormContainer.querySelector('#goButton');

        brandSelect.addEventListener('change', function() {
            const brand = this.value;
            modelSelect.innerHTML = '<option value="">Select Model</option>'; // Clear previous options
            modelSelect.disabled = !brand;

            if (brand) {
                fetch(`/get_models?brand=${brand}`)
                    .then(response => response.json())
                    .then(models => {
                        if (models.length === 0) {
                            modelSelect.innerHTML += '<option value="">No models available</option>';
                        } else {
                            models.forEach(model => {
                                const option = document.createElement('option');
                                option.value = model;
                                option.textContent = model;
                                modelSelect.appendChild(option);
                            });
                            modelSelect.classList.add('highlighted');
                        }
                    })
                    .catch(error => console.error('Error fetching models:', error));
            } else {
                modelSelect.classList.remove('highlighted');
            }
        });

        goButton.addEventListener('click', function() {
            const selectedBrand = brandSelect.value;
            const selectedModel = modelSelect.value;

            if (!selectedBrand || !selectedModel) {
                alert('Please select both brand and model.');
                return;
            }

            // Redirect to new page with selected brand and model as query parameters
            window.location.href = `${newHtmlLink}?brand=${encodeURIComponent(selectedBrand)}&model=${encodeURIComponent(selectedModel)}`;
        });
    }

});

    </script>
</body>
</html>
